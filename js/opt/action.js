(function(a,u,k){function oa(a,c){c--;return Math.floor(Math.random()*(c-a+1))+a}function pa(a){a=a.slice(0);for(var c=[];0<a.length;)c.push(a.splice(oa(0,a.length),1)[0]);return c}function J(b){a("#alert").show();a("#alert p").html(b);p();b=a("#alert").addClass("visible").position();TweenLite.fromTo("#alert",0.4,{top:0.1*e.screen.height,opacity:0},{top:b.top,opacity:1,ease:Power2.easeOut,onComplete:function(){setTimeout(function(){TweenLite.to("#alert",0.2,{top:0.1*e.screen.height,opacity:0,ease:Power2.easeOut,
onComplete:function(){a("#alert").hide()}})},2E3)}})}function K(){for(var b,c=[],d=[],h=0;h<arguments.length;h++)if(0==h){if("string"!=typeof arguments[h])return;b=arguments[h]}else if("string"==typeof arguments[h]&&2>c.length)a("#dialog .btns a").eq(c.length).text(arguments[h]),c.push(1);else if("function"==typeof arguments[h]&&d.length<c.length){var f=arguments[h];a("#dialog .btns a").eq(d.length).off("click").click(function(){f();TweenLite.to("#dialog",0.2,{top:0.1*e.screen.height,opacity:0,ease:Power2.easeOut,
onComplete:function(){a("#dialog").hide()}})});d.push(1)}else break;a("#dialog .text").html(b);1==c.length||1==d.length?a("#dialog .btns a").eq(1).hide():a("#dialog .btns a").eq(1).show();a("#dialog").show();p();b=a("#dialog").addClass("visible").position();TweenLite.fromTo("#dialog",0.4,{top:0.1*e.screen.height,opacity:0},{top:b.top,opacity:1,ease:Power2.easeOut})}function B(b){a("#auth").show();p();b=a("#auth").addClass("visible").position();TweenLite.fromTo("#auth",0.4,{top:0.1*e.screen.height,
opacity:0},{top:b.top,opacity:1,ease:Power2.easeOut})}function qa(){a("#chromeframe").show();p();a("#chromeframe").addClass("visible");TweenLite.fromTo("#chromeframe",0.4,{top:0,opacity:0},{top:0.1*e.screen.height,opacity:1,ease:Power2.easeOut})}function A(a){a=String(Math.floor(a));if(3>=a.length)return a;for(var c="",d=0;d<=Math.floor(a.length/3);d++){var e=a.length-3*(d+1),f=3;0>e&&(f+=e,e=0);if(0==f)break;0<d&&(c=","+c);c=a.substr(e,f)+c}return c}function D(a){a=Math.floor(10*a);return a/10}function E(a){var c=
document.cookie,d=c.indexOf(" "+a+"=");-1==d&&(d=c.indexOf(a+"="));-1==d?c=null:(d=c.indexOf("=",d)+1,a=c.indexOf(";",d),-1==a&&(a=c.length),c=unescape(c.substring(d,a)));return c}function w(a,c,d){var e=new Date;e.setDate(e.getDate()+d);c=escape(c)+(null==d?"":"; expires="+e.toUTCString());document.cookie=a+"="+c}function p(){a("body").css("overflow-y","scroll");a("body").css("overflow-x","hidden");var b=a(u).height(),c=a(u).width(),c=1280>c?1280:c,b=480>b?480:b;a("body").css("overflow","");e.screen.height=
b;e.screen.width=c;a(".screen,#google_map .pattern,#google_map,#nav .expand,#user_action,#welcome").css({height:b,width:c});var d=Math.floor((c-20)/9);f.size={column:d,height:b,width:c};e.screen.column=d;var h=1280/720;c/b>h?a("#video_index").css({width:c,height:c/h,top:(b-c/h)/2}):a("#video_index").css({width:b*h,height:b,left:(c-b*h)/2,top:0});a("#google_map .pattern i").not(":first").css("margin-left",d-20);a("#ui_board").css("left",7*d);a("#main .copy").css("left",d+10);a(".col1").width(d-20);
a(".col1-full").css("width",d);a("#detail,#points_history").css({height:b-40,"padding-left":d+10,width:4*d});a("#detail .article").height(b-40-88);a("#content .gallery-list .frame").height(b-20);a("#content .order1").css("right",2*-d);a("#content .order2,.gallery-list").css("right",-d);a("#content p.float-left > img,#content p.float-right > img").width(a("#content .content").width()/2);a("#content .gallery-list img").width(a("#content .gallery-list ul").width()).removeAttr("height");a("#content .img-share span.ready").removeClass("ready");
a("#content .img > img,.article .img-hover>img,.img-expand>img,.img-expand>img,.img-share>img").width(a("#detail").width()-20);a("#content .img-hover > span,#content .img-expand > span,#content .img-share,#kv_index").each(O);a("#content .img-share span").addClass("ready");a("#content #quiz").width(a("#content .content").width()-80-20);a("#gallery .frame").each(O);a("#gallery .switch a").width(0.6*d).each(O);a("#gallery .switch a.next").css("right",0.6*-d-10);a("#gallery .switch a.prev").css("left",
0.6*-d-10);a("#nav").width(c);a("#nav .contract > p").css("width",1280<c?c-(d+20):c-(d+20)-1);a("#nav .expand .home").css({"margin-right":d-20-(d-20)/2,width:(d-20)/2});0<a("#user_action").length&&(a("#user_action .bg").css("top",(b-a("#user_action .bg").height()-10)/2),a("#user_action .select p").css("left",a("#user_action .select a.email").position().left+a("#user_action .select a.email").width()-a("#user_action .select p").width()+40));a("#welcome .frame").css("top",(b-a("#welcome .frame").height()-
20)/2);a("#points_history blockquote > img").width(a("#points_history blockquote").width());a(".col-square").each(function(){a(this).css("height",a(this).width())});if(e.mode.panorama){var d=a("#panorama .view").data("width"),h=a("#panorama .view").data("height"),n=a("#panorama .view img");n.css({height:"",left:0});n.width(c).css("top",(b-n.height())/2);$(n);a("#panorama .info .circle").css("left",(c-90)/2);var m=n.width()/d,x=n.height()/h,g=n.position();a("#panorama .dot").each(function(){a(this).css({left:a(this).data("left")*
m+g.left,top:a(this).data("top")*x+g.top})});a("#panorama .hint .circle").css("margin-top",(e.screen.height-a("#panorama .hint .circle").height())/2)}a(".overlay").each(function(){a(this).css({left:(e.screen.width-a(this).width())/2-10,top:0.2*e.screen.height})})}function O(b,c){var d=a(c).prev(),h=!1,f=!1,m=!1;if(0==d.length||"img"!=d.prop("tagName").toLowerCase())d=a(c).children(),a(c).hasClass("frame")?h=!0:a(c).parent().hasClass("switch")?f=!0:m=!0;if(30>d.height())setTimeout(function(){O(b,c)},
200);else{var x=e.screen.width,g=e.screen.height;m?a("#content .img-share input").width(a("#content .img-share span").width()-90-30):h?d.height()>d.width()?d.height(g).css("left",(x-d.width())/2):(d.css({height:"",left:0}),d.width(x).css("top",(g-d.height())/2),$(d)):f?(d=d.height(),a(c).css({height:d,top:(g-d)/2})):(g=d.height(),a(c).css({height:g,width:d.width()}).children("a").css({height:g-6,width:d.width()-6}))}}function $(a){a.height()<e.screen.height&&(a.css("width",""),a.height(e.screen.height).css({top:0,
left:(e.screen.width-a.width())/2}))}function T(b){1<b?b=1:0>b&&(b=0);var c=2*b*Math.PI,d;d=16+16*Math.sin(c);c=16-16*Math.cos(c);a("#done").hide();return 0.5>=b?"M 16,16 V 0 A 16,16 0 0,1 "+d+","+c+" z":1>b?"M 16,16 V 0 A 16,16 0 1,1 "+d+","+c+" z":T(0.999)}function P(a){var c=a.getFullYear()+".",c=c+(a.getMonth()+1+".");return c+=a.getDate()}function U(a){var c=new Date(2013,4,24);a=a.getTime()-c.getTime();return Math.ceil(a/1E3/3600/24)}function t(b){a("#nav .active").removeClass("active");a("#nav .contract span").eq(b).addClass("active");
a("#nav .expand .blocks > p").eq(b+1).addClass("active")}function ra(){if(!(0<a("#content:visible").length))if(null==f.user.token)B();else{for(var b,c=f.data.location.length-1;0<=c;c--){var d=f.data.location[c];if(2==d.Status||3==d.Status){b=d;break}}b!==k&&a.post(q.api_path,{ac:"imgbyloc",loc:b.ID},function(a){v(a)&&(f.data.gallery=a,aa(a,b,!0),p())})}}function sa(b){if(!e.mode.detail)if(null==f.user.token)B();else{for(var c,d,h=b=0;h<l.length;h++)if(b+=l[h].distance,this===l[h].obj){c=l[h];d=f.data.location[h];
break}e.mode.detail=!0;a("#content .article,.jspContainer,.jspPane").css("width","");ba(c,d,b)}}function ba(b,c,d){var h;null!=f.user.token&&2==b.status&&(h=new google.maps.Marker({position:b.obj.getPosition(),clickable:!1,map:f.map,icon:{fillColor:"#ffffff",fillOpacity:1,strokeOpacity:0,path:T(0),anchor:new google.maps.Point(16,16)},optimized:!1,zIndex:1}));b.obj.setIcon({url:"img/ol-spot-on.png",anchor:new google.maps.Point(9,9)});a("#content").data("progress",{p:0,origin:b,obj:h,location:c});a("#ui_info li").eq(0).children("span").html(c.Location);
h=new Date(c.CurrentTime+"+0800");g.spin(a("#ui_info li").eq(1).children("b"),U(h),0);a("#ui_info li").eq(1).children("span").html(P(h));g.spin(a("#ui_info li").eq(2).children("b"),d,1);a("#ui_info li").eq(3).children("span").html(D(c.Latitude)+", "+D(c.Longitude));g.spin(a("#ui_info li").eq(4).children("b"),c.PhotoCount,2);e.location=b.id;a.post(q.api_path,{ac:"imgbyloc",loc:b.id,seed:Math.random()},function(c){if(v(c)){f.data.gallery=c;if(2==b.status){var d=f.data.location[b.index];a("#detail h2").html(d.Title);
a("#detail .content").html(d.RichContent);a("#content").show();a("#detail .panorama a").click(function(a){a.stopPropagation();ca(0)});a("#detail .diff a").click(function(a){a.stopPropagation();da(0)})}aa(c,b);a("html,body").css("overflow","hidden");p();a("#detail .article").jScrollPane({autoReinitialise:!0,hideFocus:!0,mouseWheelSpeed:100});a("#content").addClass("visible");a("#detail,.right-button .browse").show();ta(b.id);TweenLite.fromTo("#content",0.4,{left:-a("#content").width()},{left:0,ease:Power2.easeOut});
c=a("#content .order2").width();TweenLite.fromTo("#content .order2",0.2,{right:0},{right:-c,delay:0.3,ease:Power2.easeOut});TweenLite.fromTo("#content .order1",0.2,{right:0},{right:2*-c,delay:0.4,ease:Power2.easeOut,onComplete:function(){a(document).scrollTop(0);a("#content .article").scroll(ua)}});a(document).scrollTop(0);a("#content .article").data("jsp").scrollToY(0);if(2==b.status){f.map.setZoom(7);f.map.panTo(a("#content").data("progress").origin.obj.getPosition());c=f.size.height/2-(f.size.height-
a("#ui_board").height()+10)/2-20;f.map.panBy(-(f.size.width/2-f.size.column),-c);f.map.setOptions({draggable:!1});clearInterval(q.timer);var e=0;q.timer=setInterval(function(){e++;5>e?L():clearInterval(q.timer)},500)}}})}function ua(){if(0<e.location){var b=a("#content").data("progress"),c=a("#content .article").data("jsp").getPercentScrolledY();if(b&&b.obj){if(c>b.p){var d=b.obj.getIcon();d.path=T(c);b.obj.setIcon(d);b.p=c}1<=c&&(a("#content .article").off("scroll"),b.p=100,null!=f.user.token?(a.post(q.api_path,
{ac:"followroute",token:f.user.token,loc:e.location},function(a){v(a)&&(e.animation.flash(b.obj),F(a.points),J("\u606d\u559c\u60a8\u901a\u8fc7\u6d4f\u89c8\u884c\u7a0b\u83b7\u5f97\u4e86<i>"+a.amount+"</i>\u70b9\u79ef\u5206\u3002"),b.obj.setMap());V(b)}),e.location=0):V(b))}else 1<=c&&(a("#content .article").off("scroll"),V(b));a(document).scrollTop(0)}}function ta(b){f.data.quiz===k?a.getJSON("data/quiz.json",function(a){f.data.quiz=a;ea(b)}):ea(b)}function ea(b){for(var c=f.data.quiz,d,h=0;h<c.list.length;h++)if(c.list[h].loc===
b){d=c.list[h];break}a("#quiz").hide();if(d!==k&&!(0.5<Math.random())){e.mode.quiz=!0;c={};c.id=d.id;c.q=d.q;c.a=d.opt[d.a];c.opt=pa(d.opt);a("#quiz p.lead").html("\u95ee\u7b54\u9898\uff1a"+d.q);a("#quiz p.option").empty();for(b=0;b<d.opt.length;b++)a("#quiz p.option").append("<a><i><b></b></i><label>"+c.opt[b]+"</label></a>");a("#quiz p.option a").click(function(){a(this).hasClass("active")||(a("#quiz p.option a.active").removeClass("active"),a(this).addClass("active"))});a("#quiz").data("obj",c).show()}}
function va(){if(!z){var b=a("#quiz p.option a.active");if(0==b.length)alert("\u8bf7\u9009\u62e9\u4e00\u4e2a\u4f60\u8ba4\u4e3a\u6b63\u786e\u7684\u9009\u9879\u3002");else{var b=b.find("label").text(),c=a("#quiz").data("obj");b==c.a?(z=!0,a.post(q.api_path,{ac:"quiz",token:f.user.token,quiz:c.id,qt:c.q,as:b},function(b){v(b)?(J("\u7b54\u5bf9\u4e86\uff01\u606d\u559c\u4f60\u83b7\u5f97<i>"+b.amount+"</i>\u70b9\u79ef\u5206\u3002"),F(b.points)):114==b.code&&J("\u606d\u559c\u4f60\uff0c\u56de\u7b54\u6b63\u786e\uff01");
TweenLite.to("#quiz",0.2,{height:0,ease:Power2.easeOut,onComplete:function(){a("#quiz").hide().css("height","")}});z=e.mode.quiz=!1})):(alert("\u5f88\u9057\u61be\uff0c\u56de\u7b54\u9519\u8bef\u3002"),TweenLite.to("#quiz",0.2,{height:0,ease:Power2.easeOut,onComplete:function(){a("#quiz").hide().css("height","")}}),e.mode.quiz=!1)}}}function aa(b,c,d){b!==k&&(e.gallery_id=0,a("#content .img-share").append('<span><input type="text" placeholder="\u53d1\u8868\u60a8\u7684\u89c2\u70b9\u80fd\u8d62\u53d6\u66f4\u591a\u79ef\u5206" /><a class="btn"><b>\u5206\u4eab\u81f3\uff1a</b><i class="icon-weibo"></i></a></span>').find("a").click(fa),
a("#content .mask,#content .right-button.back").hide(),3==c.status||3==c.Status||d?(a("#gallery > .frame").click(function(){a("#gallery").css("top","100%");a("#ui_info,#nav").show();M()}),ga()):L())}function ha(b){var c=f.data.gallery.list,d=e.gallery_id+1,h=e.gallery_id-1;d>=c.length&&(d=0);0>h&&(h=c.length-1);2==c.length&&(h+=2);d=[h,d];a("#gallery > .frame").not(".active").remove();for(var h=["prev","next"],n=0;2>n;n++){var m=c[d[n]],g=a('<div class="frame"/>').appendTo("#gallery");a("<img/>").attr({src:m.FileName+
"b.jpg",alt:""}).appendTo(g);g.data("id",m.ID);a("#gallery > .switch a."+h[n]).data("index",d[n]).children().attr("src",m.FileName+"t.jpg")}2==c.length&&(a("#gallery > .switch a.prev").data("index",0).children().attr("src=",c[0].FileName+"t.jpg"),a("#gallery > .switch a.next").data("index",1).children().attr("src=",c[1].FileName+"t.jpg"));a("#gallery > .frame").click(ia);p();a("#gallery").on("mousemove",function(b){b=b.pageX;b>3*(e.screen.width/4)?a("#gallery>.switch .next").addClass("next-on"):b<
e.screen.width/4?a("#gallery>.switch .prev").addClass("prev-on"):(a("#gallery>.switch .next").removeClass("next-on"),a("#gallery>.switch .prev").removeClass("prev-on"))});b!==k&&(0<b?a("#gallery>.switch .next").addClass("next-on"):a("#gallery>.switch .prev").addClass("prev-on"))}function ia(){a("#gallery").css("top","100%").hide();a("#ui_board,#nav").show()}function Q(b){if(!e.animating){var c=a(this).data("index"),d=-1,f=a("#gallery > .frame").width(),n,m=a("#gallery > .frame").not(".active"),g=
a("#gallery > .frame.active");if(e.mode.panorama){if(0<a("#panorama .panel:visible").length||0<a("#panorama .bar > span.active").length)return;a.isNumeric(b)&&(c=b,d=c-e.panorama.index);f=e.screen.width;m=a("#panorama > .view");g=a("#panorama > .view.active")}a("#gallery").off("mousemove");a("#gallery>.switch .next").removeClass("next-on");a("#gallery>.switch .prev").removeClass("prev-on");if(a(this).hasClass("next")||0<d){n=1;if(e.mode.panorama){a.isNumeric(c)||(c=e.panorama.index+1);if(c>=e.panorama.scene)return;
n=e.panorama.index=c}else a.isNumeric(c)||(c=a("#gallery > .switch .next").data("index"));b={left:f};f=-f}else{n=0;if(e.mode.panorama){a.isNumeric(c)||(c=e.panorama.index-1);if(0>c)return;n=e.panorama.index=c}else a.isNumeric(c)||(c=a("#gallery > .switch .prev").data("index"));b={left:-f}}e.gallery_id=c;e.animating=!0;d=a(this).parent().hasClass("switch")?a(this).hasClass("next")?1:-1:k;TweenLite.fromTo(m.eq(n).addClass("visible"),0.8,b,{left:0,ease:Power2.easeOut});TweenLite.to(g,0.8,{left:f,ease:Power2.easeOut,
onComplete:function(){e.animating=!1;g.removeClass("active");m.eq(n).addClass("active");e.mode.panorama?(g.removeClass("visible"),a("#panorama > .info .browse a.active").removeClass("active"),a("#panorama > .info .browse a").eq(c).addClass("active"),a("#panorama > .info .bar span > b").text(c+1)):(ha(d),a("#gallery > .pager span > b").text(c+1))}})}}function ga(){var b=f.data.gallery.list;a("#gallery > .frame").remove();var c=a(this).data("index");c===k&&(c=0);e.gallery_id=c;ha();var d=b[c],h=a('<div class="frame"/>').appendTo("#gallery");
a("<img/>").attr({src:d.FileName+"b.jpg",alt:""}).appendTo(h);h.data("id",d.ID).addClass("visible active");a("#gallery > .pager span").html("<b>1</b> / "+b.length);a("#gallery > .pager a").click(Q);a("#gallery > .frame").click(ia);a("#gallery > .pager span > b").text(c+1);a("#gallery").css("top",0).show();a("#ui_board,#nav").hide();p()}function L(){var b=a("#google_map .pattern").parent().css("transform");if(b=/matrix\(([\d\s-,]+)\)/.exec(b)){var c=b[1].replace(/\s/g,"").split(","),b=Number(c[c.length-
2]),c=Number(c[c.length-1]);a("#google_map .pattern").css("transform","matrix(1,0,0,1,"+-b+","+-c+")")}else b=a("#google_map .pattern").parent().css("left"),c=a("#google_map .pattern").parent().css("top"),b=-Number(b.substr(0,b.length-2)),c=-Number(c.substr(0,c.length-2)),a("#google_map .pattern").css({left:b,top:c})}function wa(){if(!q.allowedBounds.contains(f.map.getCenter())){var a=f.map.getCenter(),c=a.lng(),a=a.lat(),d=q.allowedBounds.getNorthEast().lng(),e=q.allowedBounds.getNorthEast().lat(),
n=q.allowedBounds.getSouthWest().lng(),m=q.allowedBounds.getSouthWest().lat();c<n&&(c=n);c>d&&(c=d);a<m&&(a=m);a>e&&(a=e);f.map.setCenter(new google.maps.LatLng(a,c))}}function xa(){q.allowedBounds=new google.maps.LatLngBounds(new google.maps.LatLng(18.895114,75.21579),new google.maps.LatLng(45.90816,121.89743));G=[new google.maps.LatLng(43.91719,81.3241),new google.maps.LatLng(25.021529,98.490264),new google.maps.LatLng(31.240985,121.474113)];var b=[],c=new google.maps.LatLng(40.353216,98.349609),
d={center:c,zoom:5,minZoom:4,maxZoom:8,mapTypeId:google.maps.MapTypeId.SATELLITE,disableDefaultUI:!0,noClear:!0,scrollwheel:!1};f.map=new google.maps.Map(document.getElementById("google_map"),d);google.maps.event.addListener(f.map,"bounds_changed",L);google.maps.event.addListener(f.map,"zoom_changed",L);google.maps.event.addListener(f.map,"center_changed",wa);google.maps.event.addListenerOnce(f.map,"idle",function(){var b=a("#google_map .pattern").remove();a("#google_map:first-child > :first > :first > :first").prepend(b)});
google.maps.event.addDomListener(a("#map_control")[0],"click",function(){f.map.panTo(c)});google.maps.event.addDomListener(a("#map_control i")[0],"click",function(a){a.stopPropagation();f.map.setZoom(f.map.getZoom()+1)});google.maps.event.addDomListener(a("#map_control i")[1],"click",function(a){a.stopPropagation();f.map.setZoom(f.map.getZoom()-1)});a.getJSON(q.api_path,{ac:"getlocation",seed:Math.random()},function(c){if(v(c)){f.data.location=c.list;for(var d=0,x=0,y=0;y<c.list.length;y++){var s=
c.list[y],d=d+s.Distance,x=x+s.PhotoCount,q=new google.maps.LatLng(s.Latitude,s.Longitude),p={id:s.ID,index:y,type:s.Type,latlng:q,distance:s.Distance,status:s.Status};if(2==s.Status||3==s.Status){var r=new google.maps.Marker({position:q,map:f.map,icon:C[s.Type],title:s.Location,optimized:!1,zIndex:10*(C.length-s.Type)});p.obj=r;s.WayPoint&&b.push({location:q});google.maps.event.addListener(r,"mouseover",function(b){if(null==a("#content").data("progress")){this.setIcon({url:"img/ol-hover.png",anchor:new google.maps.Point(70,
44)});for(var c,d=b=0;d<l.length;d++)if(b+=l[d].distance,this===l[d].obj){c=f.data.location[d];break}c!=k&&(a("#ui_info li").eq(0).children("span").html(c.Location),d=new Date(c.CurrentTime+"+0800"),g.spin(a("#ui_info li").eq(1).children("b"),U(d),0),a("#ui_info li").eq(1).children("span").html(P(d)),g.spin(a("#ui_info li").eq(2).children("b"),b,1),a("#ui_info li").eq(3).children("span").html(D(c.Latitude)+", "+D(c.Longitude)),g.spin(a("#ui_info li").eq(4).children("b"),c.PhotoCount,2))}});google.maps.event.addListener(r,
"mouseout",function(b){if(null==a("#content").data("progress")){a:{for(b=0;b<l.length;b++)if(this===l[b].obj){b=l[b];break a}b=null}this.setIcon(C[b.type]);a("#ui_info li").eq(0).children("span").html(f.geoinfo.location);g.spin(a("#ui_info li").eq(1).children("b"),f.geoinfo.past,0);a("#ui_info li").eq(1).children("span").html(f.geoinfo.date);g.spin(a("#ui_info li").eq(2).children("b"),f.geoinfo.distance,1);a("#ui_info li").eq(3).children("span").html(f.geoinfo.latlng);g.spin(a("#ui_info li").eq(4).children("b"),
f.geoinfo.pics,2);a("#intro .stat li").eq(0).children("span").text(A(f.geoinfo.distance));a("#intro .stat li").eq(1).children("span").text(c.list.length);a("#intro .stat li").eq(2).children("span").text(A(f.geoinfo.pics))}});google.maps.event.addListener(r,"click",sa)}l.push(p)}r=new google.maps.DirectionsService;h.setMap(f.map);r.route({origin:l[0].latlng,destination:l[l.length-1].latlng,travelMode:google.maps.DirectionsTravelMode.DRIVING,waypoints:b},function(a,b){b==google.maps.DirectionsStatus.OK&&
(e.main_route=a,h.setDirections(a),L())});l[l.length-1].obj===k&&(y=l[l.length-1],r=new google.maps.Marker({position:y.latlng,map:f.map,icon:C[0],title:"\u5f53\u524d\u8f66\u961f\u4f4d\u7f6e"}),y.obj=r);r=c.list[c.list.length-1];y=new Date;f.geoinfo.location=r.Location;f.geoinfo.past=U(y);f.geoinfo.date=P(y);f.geoinfo.distance=d;f.geoinfo.latlng=D(r.Latitude)+", "+D(r.Longitude);f.geoinfo.pics=x;a("#ui_info li").eq(0).children("span").html(f.geoinfo.location);g.spin(a("#ui_info li").eq(1).children("b"),
f.geoinfo.past,0);a("#ui_info li").eq(1).children("span").html(f.geoinfo.date);g.spin(a("#ui_info li").eq(2).children("b"),f.geoinfo.distance,1);a("#ui_info li").eq(3).children("span").html(f.geoinfo.latlng);g.spin(a("#ui_info li").eq(4).children("b"),f.geoinfo.pics,2);a("#intro .stat li").eq(0).children("span").text(A(f.geoinfo.distance));a("#intro .stat li").eq(1).children("span").text(c.list.length);a("#intro .stat li").eq(2).children("span").text(A(f.geoinfo.pics));d=String(d);x=6-d.length;a("#ui_counter .digit b").text("0");
for(r=0;r<d.length;r++)a("#ui_counter .digit").eq(r+x).children("b").text(d[r])}});var h=new google.maps.DirectionsRenderer({polylineOptions:{clickable:!1,strokeOpacity:0,icons:[{icon:{path:"M 0,0 0,1",strokeColor:"#ffffff",strokeOpacity:1,scale:2},offset:"0",repeat:"6px"}]},suppressMarkers:!0});e.route=h}function ca(b){f.data.panorama!==k?ja(f.data.panorama,b):a.getJSON("data/yili.json",{seed:Math.random()},function(c){f.data.panorama=c;e.mode.panorama=!0;e.panorama={};e.panorama.discovered=0;e.panorama.array=
[];e.panorama.count=0;e.panorama.scene=c.count;for(var d in c.list)e.panorama.count+=c.list[d].items.length;a("#panorama .browse").empty();for(d=0;d<c.count;d++){var h=a('<p class="img-hover"><img src="'+c.list[d].file+'t.jpg" /><span><a></a></span></p>');a("#panorama .browse").append(h)}a("#panorama .browse a").click(function(){if(!a(this).hasClass("active")){var b=a(this).index("#panorama .browse a");Q(b);a("#panorama .bar > span > i").hide();a("#panorama .browse").hide();a("#panorama .info .circle").show();
a("#panorama .bar > span > span").show();a("#panorama .bar > span").removeClass("active")}}).first().addClass("active");a("#panorama .hint").show();a("#panorama .info .circle").hide();ja(c,b);setTimeout(function(){g.fadeOut("#panorama .hint",0.4);g.fadeIn("#panorama .info .circle",0.4)},2E3)})}function ja(b,c){e.panorama.index=c;a("#panorama .view").remove();a("#panorama .bar > span > span").html("<b>"+(c+1)+"</b> / "+b.count);a("#panorama .info .circle b").text(e.panorama.discovered);for(var d=b.count-
1;0<=d;d--){for(var f=a('<div class="view"/>'),n=0;n<b.list[d].items.length;n++){var m=b.list[d].items[n],g=a('<a class="dot"><span><i><b></b></i></span></a>');g.data({left:m.x,top:m.y,id:m.id});f.append(g)}f.append('<img src="'+b.list[d].file+'b.jpg" />').prependTo("#panorama").data({height:b.list[d].height,width:b.list[d].width})}a("#panorama .view:first").addClass("visible active");a("#panorama .dot").click(ya);a("#ui_board,#nav").hide();a("#panorama").show();p()}function ya(){if(!(0<a("#panorama .panel:visible").length||
0<a("#panorama .bar > span.active").length))if(null==f.user.token)B();else{var b=a(this).index(),c=a(this).position(),d=a(this).parent().position().left,h=a(this).data("id");e.panorama.array[h]||(e.panorama.array[h]=1,e.panorama.discovered+=1,e.panorama.discovered==e.panorama.count&&a.post(q.api_path,{ac:"gamecomplete",token:f.user.token,game:1},function(b){v(b)&&(K("<b>\u606d\u559c\uff01\u672c\u7ad9\u53d1\u73b0\u4efb\u52a1\u5b8c\u6210\u3002</b><br />\u4f60\u83b7\u5f97\u4e86<i>"+b.amount+"</i>\u70b9\u79ef\u5206\u3002",
"\u8fd4\u56de",function(){e.mode.panorama=!1;a("#panorama").hide();a("#ui_board,#nav").show();e.game_spots[0].setIcon({url:"img/my_1_on.png",anchor:new google.maps.Point(33,66)})}),F(b.points))}));a(this).addClass("active");a("#panorama .info .circle").removeClass("active").html("\u53d1\u73b0<b>"+e.panorama.discovered+"</b>");a("#panorama .panel").css("left",c.left+d).css("visibility","hidden").show();var n=1;c.left+d+a("#panorama .panel").width()+16>e.screen.width&&(a("#panorama .panel").css("left",
c.left-d-a("#panorama .panel").width()-16),n=-1);b=a("#panorama .panel").children().text(f.data.panorama.list[e.panorama.index].items[b].desc).height();c.top+45+b+20>e.screen.height?a("#panorama .panel p").css("margin-top",c.top-45-b):a("#panorama .panel p").css("margin-top",c.top+45);a("#panorama .dot").not(".active").hide();a("#panorama .mask").addClass("cursor-close").one("click",function(){a("#panorama .dot.active").removeClass("active");a("#panorama .mask").removeClass("cursor-close");g.fadeOut("#panorama .panel p",
0.2);var b=a("#panorama .panel").css("visibility","").width();if(0<n)TweenLite.to("#panorama .panel",0.2,{width:0,delay:0.2,ease:Power2.easeOut});else{var c=a("#panorama .panel").css("left"),c=Number(c.substr(0,c.length-2));TweenLite.to("#panorama .panel",0.2,{left:c+b,width:0,delay:0.2,ease:Power2.easeOut})}g.fadeOut("#panorama .mask",0.2,0.2,function(){a("#panorama .panel").width(b).hide();a("#panorama .dot").show()})});g.fadeIn("#panorama .mask",0.2);a("#panorama .panel p").hide();c=a("#panorama .panel").css("visibility",
"").width();0<n?TweenLite.fromTo("#panorama .panel",0.4,{width:0},{width:c,ease:Power2.easeOut}):(b=a("#panorama .panel").css("left"),b=Number(b.substr(0,b.length-2)),TweenLite.fromTo("#panorama .panel",0.4,{left:b+c,width:0},{left:b,width:c,ease:Power2.easeOut}));g.fadeIn("#panorama .panel p",0.2,0.4);t(1)}}function da(b){f.data.diff!==k?ka(b):a.getJSON("data/tengchong.json",{seed:Math.random()},function(a){f.data.diff=a;e.diff={};ka(b)})}function ka(){var b=function(){a("#difference .view").each(function(){var b=
a(this).children("img"),c,d=a(this).hasClass("horizon");if(d){var f=e.screen.width;c=f/a(this).data("width");var h=a(this).data("height")*c;2*(h+12)>e.screen.height&&(h=(e.screen.height-12)/2,c=h/a(this).data("height"),f=a(this).data("width")*c);b.height(h).width(f);a(this).width(f).data("ratio",c).css({top:(e.screen.height-a(this).height())/2,left:(e.screen.width-a(this).width())/2})}else{f=a(this).height();c=f/a(this).data("height");var g=a(this).data("width")*c;b.height(f).width(g);a(this).data("ratio",
c).css("left",(e.screen.width-a(this).width())/2)}a(this).hasClass("active")&&a(this).find(".diff.major").each(function(){var b=a(this).data("pos"),e=b.x*c+6-24,b=b.y*c-24;a(this).css({left:e,top:b});var f=a(this).data("sub");d?f.css({left:e,top:b+h+12}):f.css({left:e+g+12,top:b})})});a("#difference .circle").css("left",(e.screen.width-90)/2)};a("#difference .view").remove();for(var c=f.data.diff.count-1;0<=c;c--){var d=f.data.diff.list[c],h=a('<div class="view"/>').append('<img src="'+d.file[0]+
'" />').append('<img src="'+d.file[1]+'" />').data({height:d.height,width:d.width});"horizon"==d.orientation&&(h.addClass("horizon"),h.find("img:first").addClass("top"));a("#difference").prepend(h)}a("#difference").show();a("#ui_board,#nav").hide();a("#difference .circle b").text(e.diff.found);a("#difference .view").data("list",d.items.slice(0));a("#difference .hint a").one("click",function(){TweenLite.to("#difference .hint",0.3,{bottom:-a("#difference .hint").height()-30,ease:Power2.easeOut,onComplete:function(){W()}});
g.fadeOut("#difference .mask",0.3);g.fadeIn("#difference .circle,#difference .timer",0.3)});a("#difference .hint").css("visibility","hidden").show();b();a(u).resize(b);a("#difference .view img").click(za);a("#difference .circle,#difference .timer").hide();g.fadeIn("#difference .mask",0.4);a("#difference .hint").css("visibility","");TweenLite.fromTo("#difference .hint",0.4,{bottom:-a("#difference .hint").height()-30},{bottom:2,ease:Power2.easeOut});e.diff.bonus=[];X(0,!0)}function W(){var b=a("#difference .timer b"),
c=String(e.diff.time);b.eq(1).text(c[c.length-1]);1<c.length?b.eq(0).text(c[0]):b.eq(0).text(0);0>=e.diff.time?K("\u5f88\u9057\u61be\uff0c\u65f6\u95f4\u5230\uff01","\u518d\u73a9\u4e00\u6b21",function(){e.diff.bonus=[];X(0)}):e.diff.timer=setTimeout(W,1E3);e.diff.time-=1}function X(b,c){var d=f.data.diff.list[b];e.diff.time=60;e.diff.found=d.items.length;e.diff.index=b;a("#difference .view .diff").remove();a("#difference .circle b").text(e.diff.found);a("#difference .view.active").removeClass("active");
a("#difference .view").eq(b).data("list",d.items.slice(0)).addClass("visible active");if(!c){var h=a("#difference .view").eq(b-1),d=a("#difference .view.active"),g=(e.screen.width-d.width())/2,m=(e.screen.width-h.width())/2;TweenLite.fromTo(d,0.8,{left:g+e.screen.width},{left:g,ease:Power2.easeOut});TweenLite.to(h,0.8,{left:m-e.screen.width,ease:Power2.easeOut,onComplete:function(){h.removeClass("visible");W()}})}}function za(b){var c=a("#difference .view.active").data("list"),d=a("#difference .view.active").data("ratio"),
h=b.offsetX/d;b=b.offsetY/d;for(var g=0;g<c.length;g++){var m=c[g].rect;if(h>m[0]&&h<m[2]&&b>m[1]&&b<m[3]){c.splice(g,1);h=a("#difference .view.active").hasClass("horizon");b={};g=a("#difference .view.active img").width();b.x=(m[0]+m[2])/2;b.y=(m[1]+m[3])/2;var k=b.x*d+6-24,l=b.y*d-24,d=a('<i class="diff major"/>').css({left:k,top:l}),m=d.clone().removeClass("major");h?m.css("top",l+a("#difference .view.active img").height()+12):m.css("left",k+g+12);d.data({pos:b,sub:m});e.diff.found-=1;a("#difference .circle b").text(e.diff.found);
if(0==e.diff.found)if(clearTimeout(e.diff.timer),e.diff.bonus.push(e.diff.time+1),e.diff.index<f.data.diff.count-1)K("<b>\u606d\u559c\uff01\u53d1\u73b0\u4efb\u52a1\u5b8c\u6210\u3002</b><br />\u8fd8\u6709\u66f4\u591a\u5173\u5361\u7b49\u4f60\u53d1\u73b0\u3002","\u4e0b\u4e00\u5173",function(){X(e.diff.index+1)});else{var h=0,p;for(b=0;b<e.diff.bonus.length;b++)h+=e.diff.bonus[b];p=Math.floor(h/e.diff.bonus.length);a.post(q.api_path,{ac:"gamecomplete",ext:p,token:f.user.token,game:2},function(b){v(b)&&
(K("<b>\u606d\u559c\uff01\u672c\u7ad9\u53d1\u73b0\u4efb\u52a1\u5b8c\u6210\u3002</b><br />\u4f60\u83b7\u5f97\u4e86<i>"+b.amount+"</i>\u70b9\u79ef\u5206\uff08\u542b\u65f6\u95f4\u5956\u52b1<i>"+p+"</i>\u70b9\u79ef\u5206\uff09\u3002","\u8fd4\u56de",function(){a("#dialog .close").click();a("#difference").hide();a("#ui_board,#nav").show();e.game_spots[1].setIcon({url:"img/my_2_on.png",anchor:new google.maps.Point(33,66)})}),F(b.points));114==b.code&&K("<b>\u606d\u559c\uff01\u672c\u7ad9\u53d1\u73b0\u4efb\u52a1\u5b8c\u6210\u3002</b>",
"\u8fd4\u56de",function(){a("#dialog .close").click();a("#difference").hide();a("#ui_board,#nav").show()})})}a("#difference .view.active").data("list",c).append(d,m);break}}}function la(b){if(z)return!1;if(b.keyCode){if(13!=b.keyCode)return}else if(b.charCode&&13!=b.charCode)return;var c=a(this).parents("form");b=c.find('[name="email"]');if(""!=b.val()&&b.val()!=b.attr("placeholder")){if(!/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(b.val()))return alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7535\u5b50\u90ae\u7bb1\u3002"),
b.select(),!1}else return alert("\u8bf7\u8f93\u5165\u7535\u5b50\u90ae\u7bb1\u3002"),b.focus(),!1;b=c.find('[name="pass"]');if(""!=b.val()&&b.val()!=b.attr("placeholder")){var d=c.find('[name="repass"]');if(0<d.length)if(""!=d.val()&&d.val()!=d.attr("placeholder")){if(d.val()!=b.val())return alert("\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u5339\u914d\u3002"),d.select(),!1}else return alert("\u8bf7\u518d\u8f93\u5165\u4e00\u6b21\u5bc6\u7801\u3002"),d.focus(),!1}else return alert("\u8bf7\u8f93\u5165\u5bc6\u7801\u3002"),
b.focus(),!1;z=!0;c.find("button").addClass("loading");a.post(q.api_path,c.serialize(),function(a){z=!1;c.find("button").removeClass("loading");v(a)&&Y(a)})}function Y(b){if(null==b.token||""==b.token||"null"==b.token)return R(),!1;f.user.token=b.token;w("auth_token",b.token);null!=b.sinaid&&(""!=b.sinaid&&0!=b.sinaid)&&(w("weibo_user",!0),f.user.weibo=!0);if(e.game_spots!==k){for(var c=0;c<e.game_spots.length;c++)e.game_spots[c].setMap(null);e.game_spots=k}e.mode.my_journey&&S();F(b.points);a("#ui_user .btns,#user_action,#auth").hide();
a("#ui_user .bar").show();a("#ui_user .btn-left").show()}function R(){f.user.token=null;f.user.points=null;f.user.weibo=!1;if(e.game_spots!==k){for(var b=0;b<e.game_spots.length;b++)e.game_spots[b].setMap(null);e.game_spots=k}e.mode.my_journey&&S();w("auth_token",null,new Date);w("user_points","",new Date);w("weibo_user","",new Date);a("#ui_user .btns").show();a("#ui_user .bar").hide();a("#ui_user .btn-left").hide()}function fa(){if(!z){var b,c,d=!1;this!==u&&"span"==a(this).parent().prop("tagName").toLowerCase()?
c=a(this).prev():(c=a("#gallery .share textarea"),d=!0);b=c.val();if(""==b)return alert("\u8fd8\u662f\u8bf4\u4e00\u70b9\u4ec0\u4e48\u5427\u3002"),c.focus(),!1;null==f.user.token?B():f.user.weibo?(d?(a('input[name="pic"]').val(a("#gallery .frame.visible").children().attr("src")),a('input[name="token"]').val(f.user.token),a('input[name="url"]').val(u.location.href),a('input[name="gid"]').val(a("#gallery .frame.visible").data("id")),b=a("#gallery .share form").serialize()):b={ac:"galleryshare",status:b,
pic:a(this).parent().prev().attr("src"),token:f.user.token},z=!0,a.post(q.api_path,b,function(b){z=!1;v(b)?(F(b.points),J("<b>\u5206\u4eab\u6210\u529f\uff01</b>\u606d\u559c\u60a8\u83b7\u5f97\u4e86<i>"+b.amount+"</i>\u70b9\u79ef\u5206\u3002"),c.val(""),a("#gallery .mask").off("click").removeClass("cursor-close"),g.fadeOut("#gallery .share form",0.4,0,function(){a("#gallery .share form").removeClass("bg");a("#gallery .share,#gallery .share .pattern").css("height","");a("#gallery textarea").css("display",
"");a("#gallery .mask").hide();a("#gallery .share p.submit span").width(0);a("#gallery .share p.submit").removeClass("submit")})):114==b.code&&(J("\u5206\u4eab\u6210\u529f\uff01"),c.val(""))})):(alert("\u8bf7\u5148\u7ed1\u5b9a\u4e00\u4e2a\u5fae\u535a\u8d26\u53f7\u3002"),H())}}function Aa(){N();a.post(q.api_path,{ac:"pointshistory",token:f.user.token,seed:Math.random()},function(b){if(v(b)){for(var c=a("#points_history .article").empty(),d,e=0;e<b.list.length;e++){var f=b.list[e],g=P(new Date(f.AddTime));
if(!d||d!=g)d=g,c.append("<h2>"+d+'</h2><div class="block"></div>');var g=c.find(".block:last"),k=a('<div class="item"/>');a('<i class="circle"/>').text("+"+A(f.Amount)).appendTo(k);switch(f.Type){case 1:k.append('<p class="single-line">\u884c\u8fdb<b>'+f.Quantity+"</b>\u516c\u91cc</p>");break;case 2:k.append('<p class="single-line selection">\u56de\u7b54\u968f\u673a\u95ee\u9898</p>');break;case 3:k.append('<blockquote><img src="'+f.Content1+'" /><div class="comment"><h5>\u6211\u7684\u8bc4\u8bba</h5><p>'+
f.Content2+"</p></div></blockquote>");break;case 4:k.append('<img src="'+f.Content1+'" />');break;case 5:k.append('<p class="single-line">'+f.Summary+"</p>");break;default:return}g.append(k)}a("#content").addClass("visible");a("#detail,.right-button .browse,#content .mask-white").hide();a("#content,#points_history,.right-button .satellite").show();p();TweenLite.fromTo("#content",0.4,{left:-a("#content").width()},{left:0,ease:Power2.easeOut});b=a("#content .order2").width();TweenLite.fromTo("#content .order2",
0.2,{right:0},{right:-b,delay:0.3,ease:Power2.easeOut});TweenLite.fromTo("#content .order1",0.2,{right:0},{right:2*-b,delay:0.4,ease:Power2.easeOut});a("#content .gallery-list").removeClass("visible");a("#gallery").css("top","100%")}})}function F(b){f.user.points=b;w("user_points",b);a("#ui_user .bar span b").text(A(b))}function H(){u.open("OAuth.aspx?auth=1","auth_weibo","width=615,height=505")}function v(b){if(0==b.code)return!0;101==b.code?(alert("\u8be5\u90ae\u7bb1\u5df2\u88ab\u4f7f\u7528\u3002"),
a('input[name="email"]').select()):102==b.code?alert("\u90ae\u7bb1\u6216\u5bc6\u7801\u9519\u8bef\u3002"):110===b.code?(B(),R()):111===b.code?(B(),R()):112==b.code?alert("\u5fae\u535a\u8d26\u53f7\u5df2\u7ed1\u5b9a\u5230\u5176\u5b83\u8d26\u53f7\uff0c\u8bf7\u76f4\u63a5\u7528\u5fae\u535a\u8d26\u53f7\u767b\u5f55\u3002"):113==b.code?(alert("\u8bf7\u5148\u7ed1\u5b9a\u4f60\u7684\u5fae\u535a\u8d26\u53f7\u3002"),H()):114!=b.code&&alert("\u53d1\u751f\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\u3002");return!1}function I(b,
c){var d=["#about","#vehicle","#media"];b>=d.length||0>b||(a(d[b]).show(),0==b&&c!==k&&(a("#about .tabs li").removeClass("active").eq(c).addClass("active"),a("#about .tab-item").hide().eq(c).show()),TweenLite.fromTo(d[b]+" .frame",0.3,{bottom:-a(d[b]+" .frame").height()},{bottom:0,ease:Power2.easeOut}),TweenLite.fromTo(d[b]+" .frame .head",0.4,{opacity:0},{opacity:1,delay:0.2,ease:Power2.easeOut}),TweenLite.killTweensOf("#main > .mask-alpha3,#main > .pattern-about"),a("#main > .mask-alpha3,#main > .pattern-about").css("opacity",
1).show())}function N(){a(".gallery-list").removeClass("visible");a("#content .mask,#content .right-button.back").hide();a("#ui_info").show();var b=a("#about:visible,#vehicle:visible,#media:visible");0<b.length&&(TweenLite.to(b.find(".frame .head"),0.2,{opacity:0,ease:Power2.easeOut}),TweenLite.to(b.find(".frame"),0.3,{bottom:-b.find(".frame").height(),delay:0.1,ease:Power2.easeOut,onComplete:function(){b.hide()}}),g.fadeOut("#main > .mask-alpha3,#main > .pattern-about",0.2,0.1))}function S(){e.mode.my_journey=
!0;for(var b=0;b<l.length;b++)l[b].obj!==k&&l[b].obj.setMap(null);b=[];b.push({location:G[1]});b.push({location:new google.maps.LatLng(21.345505,110.287258)});b.push({location:new google.maps.LatLng(24.595675,118.010818)});var c=new google.maps.DirectionsRenderer({polylineOptions:{clickable:!1,strokeOpacity:0,icons:[{icon:{path:"M 0,0 0,1",strokeColor:"#ffffff",strokeOpacity:1,scale:2},offset:"0",repeat:"6px"}]},suppressMarkers:!0});if(e.my_route===k){var d=new google.maps.DirectionsService;c.setMap(f.map);
d.route({origin:G[0],destination:G[2],travelMode:google.maps.DirectionsTravelMode.DRIVING,waypoints:b},function(a,b){b==google.maps.DirectionsStatus.OK&&(e.my_route=a,e.route.setDirections(a))})}else e.route.setDirections(e.my_route);f.user.token?a.post(q.api_path,{ac:"pointshistory",token:f.user.token,seed:Math.random()},ma):ma()}function ma(b){b!==k&&v(b);for(var c=[new google.maps.Point(52,106),new google.maps.Point(33,66)],d=[],h=0;h<G.length;h++)if(e.game_spots!==k)e.game_spots[h].setMap(f.map);
else{var g;1<h?g={url:"img/my_"+h+"_off.png",anchor:c[1]}:(g={url:"img/my_"+h+".png",anchor:c[0]},b!==k&&Ba(h+1,b.list)&&(g.url="img/my_"+h+"_on.png",g.anchor=c[1]));g=new google.maps.Marker({position:G[h],map:f.map,icon:g});d.push(g);google.maps.event.addListener(g,"click",function(b){0==a.inArray(this,d)?ca(0):da(0)})}a("#ui_user .btn-left a").addClass("back").children().text("\u8fd4\u56de").addClass("back");a("#ui_info").hide();e.game_spots===k&&(e.game_spots=d)}function V(a){if(a!==k){a.obj&&
a.obj.setMap();a.origin.obj.setIcon(C[a.origin.type]);for(var c=a.location,c=0,d,e=0;c<f.data.location.length;c++)if(e+=f.data.location[c].Distance,f.data.location[c].ID>a.location.ID&&1<f.data.location[c].Status){d=f.data.location[c];break}d!==k&&(c=l[c],ba(c,d,e))}}function M(b){if(b=a("#content").data("progress"))b.obj&&b.obj.setMap(),b.origin.obj.setIcon(C[b.origin.type]),f.map.setOptions({draggable:!0}),e.mode.detail=!1,a("#content").data("progress",null);e.mode.my_journey?t(1):t(0);0<a("#content:visible").length&&
(TweenLite.to("#content .order1",0.2,{right:0,ease:Power2.easeOut}),TweenLite.to("#content .order2",0.2,{right:0,delay:0.1,ease:Power2.easeOut}),TweenLite.to("#content .gallery-list",0.2,{right:0,delay:0.1,ease:Power2.easeOut}),TweenLite.to("#content",0.4,{left:-a("#content").width(),delay:0.2,ease:Power2.easeOut,onComplete:function(){a("#content").hide();a(".gallery-list ul").empty();a("#points_history,.right-button .satellite").hide()}}),a("html,body").css("overflow",""),p());a("#ui_info li").eq(0).children("span").html(f.geoinfo.location);
g.spin(a("#ui_info li").eq(1).children("b"),f.geoinfo.past,0);a("#ui_info li").eq(1).children("span").html(f.geoinfo.date);g.spin(a("#ui_info li").eq(2).children("b"),f.geoinfo.distance,1);a("#ui_info li").eq(3).children("span").html(f.geoinfo.latlng);g.spin(a("#ui_info li").eq(4).children("b"),f.geoinfo.pics,2)}function Ba(a,c){for(var d=0;d<c.length;d++)if(c[d].ContentID==a&&4==c[d].Type)return!0;return!1}function na(){a("#panorama").hide();a("#ui_board").show();e.route.setDirections(e.main_route);
for(var b=0;b<l.length;b++)l[b].obj!==k&&l[b].obj.setMap(f.map);for(b=0;b<e.game_spots.length;b++)e.game_spots[b].setMap(null);e.mode.my_journey=!1}function Ca(){a("#nav .contract").click(function(){g.fadeOut("#nav .contract",0.2);g.fadeIn("#nav .expand",0.2);var b=a("#nav .blocks .col1").height();TweenLite.fromTo("#nav .blocks",0.4,{bottom:-b},{bottom:10,delay:0.12,ease:Power2.easeOut})});a("#nav .expand").click(function(){var b=a("#nav .blocks .col1").height();TweenLite.to("#nav .blocks",0.3,{bottom:-b,
ease:Back.easeIn});g.fadeOut("#nav .expand",0.2,0.3);g.fadeIn("#nav .contract",0.2,0.4)});a("#nav .expand p").click(function(){if(!a(this).hasClass("active")){N();var b=a(this).index();t(b-1);switch(b){case 1:M();e.mode.my_journey&&na();break;case 2:if(null==f.user.token){B();t(0);break}S();t(1);break;case 3:I(0,0);break;case 4:I(1);break;case 5:I(2);break;default:t(0)}}});a("#btn_rule").click(function(){N();I(0,1);t(2)});a("#about .btn-simple").click(function(){a("#about").hide();a("#main > .mask-alpha3").hide();
a("#main > .pattern-about").hide();M();if(e.mode.my_journey){a("#panorama").hide();a("#ui_board").show();e.route.setDirections(e.main_route);for(var b=0;b<l.length;b++)l[b].obj!==k&&l[b].obj.setMap(f.map);for(b=0;b<e.game_spots.length;b++)e.game_spots[b].setMap(null);e.mode.my_journey=!1}t(0)});a(".cursor-close").click(function(){N();e.mode.my_journey?t(1):t(0)});a("#footer .share li").click(function(){switch(a(this).attr("class")){case "weibo":shareToWeibo("\u8def\u864e\u4e2d\u56fd#\u53d1\u73b0\u65e0\u6b62\u5883 \u4e2d\u56fd\u6700\u7f8e\u524d\u7ebf#\u63a2\u4eab\u4e4b\u65c5\uff0c\u76f4\u9a71\u8fb9\u9672\u4eba\u8ff9\u7f55\u81f3\u4e4b\u5883\uff0c\u6311\u6218\u53f2\u65e0\u524d\u4f8b\u7684\u5168\u5929\u5019\u5168\u5730\u5f62\u8def\u51b5\uff0c\u7eb5\u60c5\u5c3d\u63fd\u4f0a\u7281\u7684\u5929\u5730\u4ea4\u878d\u4e4b\u5343\u8272\uff0c\u6df1\u5165\u89e6\u6d89\u817e\u51b2\u7684\u65f6\u5149\u4ea4\u6c47\u4e4b\u53e4\u9999\uff0c\u63a2\u7d22\u4e0a\u6d77\u7684\u7075\u611f\u78b0\u649e\u4e4b\u65b0\u5c1a\uff0c\u53d1\u73b0\u4e2d\u56fd\u6700\u524d\u7ebf\u7684\u878d\u5408\u4e4b\u7f8e\u3002",
"","http://lr-nsd.com/");break;case "renren":shareToRenren("\u53d1\u73b0\u65e0\u6b62\u5883 \u4e2d\u56fd\u6700\u7f8e\u524d\u7ebf","\u8def\u864e\u4e2d\u56fd#\u53d1\u73b0\u65e0\u6b62\u5883 \u4e2d\u56fd\u6700\u7f8e\u524d\u7ebf#\u63a2\u4eab\u4e4b\u65c5\uff0c\u76f4\u9a71\u8fb9\u9672\u4eba\u8ff9\u7f55\u81f3\u4e4b\u5883\uff0c\u6311\u6218\u53f2\u65e0\u524d\u4f8b\u7684\u5168\u5929\u5019\u5168\u5730\u5f62\u8def\u51b5\uff0c\u7eb5\u60c5\u5c3d\u63fd\u4f0a\u7281\u7684\u5929\u5730\u4ea4\u878d\u4e4b\u5343\u8272\uff0c\u6df1\u5165\u89e6\u6d89\u817e\u51b2\u7684\u65f6\u5149\u4ea4\u6c47\u4e4b\u53e4\u9999\uff0c\u63a2\u7d22\u4e0a\u6d77\u7684\u7075\u611f\u78b0\u649e\u4e4b\u65b0\u5c1a\uff0c\u53d1\u73b0\u4e2d\u56fd\u6700\u524d\u7ebf\u7684\u878d\u5408\u4e4b\u7f8e\u3002",
"","http://lr-nsd.com/");break;case "douban":shareToDouban("\u8def\u864e\u4e2d\u56fd#\u53d1\u73b0\u65e0\u6b62\u5883 \u4e2d\u56fd\u6700\u7f8e\u524d\u7ebf#\u63a2\u4eab\u4e4b\u65c5\uff0c\u76f4\u9a71\u8fb9\u9672\u4eba\u8ff9\u7f55\u81f3\u4e4b\u5883\uff0c\u6311\u6218\u53f2\u65e0\u524d\u4f8b\u7684\u5168\u5929\u5019\u5168\u5730\u5f62\u8def\u51b5\uff0c\u7eb5\u60c5\u5c3d\u63fd\u4f0a\u7281\u7684\u5929\u5730\u4ea4\u878d\u4e4b\u5343\u8272\uff0c\u6df1\u5165\u89e6\u6d89\u817e\u51b2\u7684\u65f6\u5149\u4ea4\u6c47\u4e4b\u53e4\u9999\uff0c\u63a2\u7d22\u4e0a\u6d77\u7684\u7075\u611f\u78b0\u649e\u4e4b\u65b0\u5c1a\uff0c\u53d1\u73b0\u4e2d\u56fd\u6700\u524d\u7ebf\u7684\u878d\u5408\u4e4b\u7f8e\u3002",
"","http://lr-nsd.com/")}});a("#detail .article").click(function(a){a.stopPropagation()});a("#content .right-button a.browse").click(function(b){b.stopPropagation();b=f.data.gallery;var c=a("#content").data("progress").location;a(".gallery-list ul").empty();for(var d=0;d<b.list.length;d++){var e=b.list[d],k=a('<li class="img-hover"/>').appendTo(".gallery-list ul");a("<img/>").attr({src:e.FileName+"t.jpg",alt:c.Location}).appendTo(k);k.append('<span><a data-index="'+d+'"></a></span>')}p();a("#content .gallery-list li a").click(ga);
a("#content .gallery-list").css("opacity",0).addClass("visible");g.fadeIn("#content .gallery-list",0.4);a("#content .mask,#content .right-button.back").show()});a("#content").click(M);a("#content .right-button.back a").click(function(b){b.stopPropagation();a(".gallery-list").removeClass("visible");a("#content .mask,#content .right-button.back").hide()});a("#content .gallery-list").click(function(a){a.stopPropagation()});a("#content .mask-white").click(function(a){a.stopPropagation()});a("#gallery>.switch a").click(Q);
a("#gallery .share a.btn").hover(function(){a(this).children("span").width(50)},function(){a(this).parent().hasClass("submit")||a(this).children("span").width(0)}).click(function(){if(a(this).parent().hasClass("submit"))fa();else{a("#gallery .share form").addClass("bg");var b=a("#gallery .share form").height(),c=a("#gallery .share a.btn").height();a("#gallery .share").height(c);a(this).parent().addClass("submit");a("#gallery textarea").hide();g.fadeIn("#gallery .mask",0.2);g.fadeIn("#gallery .share form",
0.3);TweenLite.to("#gallery .share",0.4,{height:b-c-8,ease:Power2.easeOut});TweenLite.to("#gallery .share .bg .pattern",0.4,{height:b-c-c-8,ease:Power2.easeOut});g.fadeIn("#gallery textarea",0.2,0.4,function(){a("#gallery textarea").focus()})}a("#gallery .mask").addClass("cursor-close").one("click",function(){a(this).removeClass("cursor-close");g.fadeOut("#gallery .share form",0.4,0,function(){a("#gallery .share form").removeClass("bg");a("#gallery .share,#gallery .share .pattern").css("height","");
a("#gallery textarea").css("display","");a("#gallery .mask").hide();a("#gallery .share p.submit span").width(0);a("#gallery .share p.submit").removeClass("submit")})})});a("#ui_user .btns a").click(function(){var b=a(this).index();a(this).parent().hasClass("btn-left")?a(this).hasClass("back")?(N(),M(),na(),a(this).removeClass("back").children().text("\u6211\u7684\u53d1\u73b0"),t(0)):(S(),t(1)):0==b?H():(a("#user_action").show(),a("#user_action .pattern").hide(),a("#user_action").addClass("wide"),
a(".select").hide(),a(".login").show(),a(".login input:first").focus(),p())});a("#ui_user .bar > span,#ui_user a.point").click(Aa);a("#ui_user a.exit").click(R);a("#ui_info .pic").click(ra);a("#user_action a.weibo").click(H);a("#user_action a.email").click(function(){a("#user_action").addClass("wide");a(".select").hide();a(".login").show();a(".login input:first").focus();p()});a("#user_action a.exist").click(function(){a(".select").hide();a(".register").show();a(".register input:first").focus();p()});
a("#user_action .textbox").focus(function(){a(this).hasClass("placeholder")&&(a(this).val("").removeClass("placeholder"),a(this).hasClass("password")&&a(this).attr("type","password"))});a("#user_action .textbox").blur(function(){""==a(this).val()&&(a(this).val(a(this).attr("placeholder")).addClass("placeholder"),a(this).hasClass("password")&&a(this).attr("type","text"))});a("#user_action .login p a").click(function(){a("#user_action .pattern").hide();a("#user_action .select").hide();a("#user_action .register").show();
a(".register input:first").focus()});a("#user_action .mask").click(function(){a("#user_action").hide()});a("#user_action button").click(la);a("#user_action input.textbox").keypress(la);a("#about .tabs li").click(function(){if(!a(this).hasClass("active")){var b=a(this).index();a("#about .tab-item").hide().eq(b).show();a("#about .tabs li.active").removeClass("active");a(this).addClass("active")}});a("#panorama .info .circle").click(function(){0<a("#panorama .panel:visible").length||(a(this).hasClass("active")?
(a("#panorama .mask").hide(),a("#panorama .info .circle").html("\u53d1\u73b0<b>"+e.panorama.discovered+"</b>")):(a("#panorama .mask").css("opacity","").show(),a("#panorama .info .circle").html("\u5269\u4f59<b>"+(e.panorama.count-e.panorama.discovered)+"</b>")),a(this).toggleClass("active"))});a("#panorama .bar > span").click(function(){0<a("#panorama .panel:visible").length||0<a("#panorama .info .circle.active").length||(a(this).hasClass("active")?(a(this).children("i").hide(),a("#panorama .info .browse").hide(),
a("#panorama .info .circle").show(),a(this).children("span").show()):(a(this).children("i").show(),a("#panorama .info .browse").show(),a("#panorama .info .circle").hide(),a(this).children("span").hide()),a(this).toggleClass("active"))});a("#panorama .bar > a").click(Q);a("#panorama a.close").click(function(){e.mode.panorama=!1;a("#panorama").hide();a("#ui_board,#nav").show()});a("#difference a.close").click(function(){clearTimeout(e.diff.timer);a("#dialog .close").click();a("#difference").hide();
a("#ui_board,#nav").show()});a("#auth .close").click(function(){TweenLite.to("#auth",0.2,{top:0.1*e.screen.height,opacity:0,ease:Power2.easeOut,onComplete:function(){a("#auth").hide()}})});a(".overlay .close").click(function(){TweenLite.to(a(this).parent(),0.2,{top:0.1*e.screen.height,opacity:0,ease:Power2.easeOut,onComplete:function(){a("#auth").hide()}})});a("#auth .more a").click(function(){TweenLite.to("#auth",0.2,{top:0.1*e.screen.height,opacity:0,ease:Power2.easeOut,onComplete:function(){a("#auth").hide()}});
I(0)});a("#auth .weibo").click(function(){H()});a("#auth .mail").click(function(){a("#auth").hide();a("#user_action").show();a("#user_action .pattern").hide();a("#user_action").addClass("wide");a(".select").hide();a(".login").show();a(".login input:first").focus();p()});a("#chromeframe .ignore a").click(function(){w("upgrade_ignore","yes",1);TweenLite.to("#chromeframe",0.2,{top:0.1*e.screen.height,opacity:0,ease:Power2.easeOut,onComplete:function(){a("#chromeframe").hide()}})});a("#quiz .submit").click(va);
a("#welcome .weibo").click(H);a("#welcome .skip,#welcome .mask").click(function(){g.fadeOut("#welcome",0.4)});a("#welcome .links a").click(function(){if(!a(this).hasClass("skip")){g.fadeOut("#welcome",0.2);var b=a(this).index();I(0,b+1)}});a("#bgm_control").click(function(){var b=a("#bgm")[0];a(this).children("i").hasClass("bgm-on")?(b.pause(),a(this).children("i").removeClass("bgm-on").addClass("bgm-off"),a(this).find("span b").text("off"),w("bgm_mute","yes",90)):(b.play(),a(this).children("i").removeClass("bgm-off").addClass("bgm-on"),
a(this).find("span b").text("on"),b.volume=0.25,w("bgm_mute",null,0))})}var f={},q={},e={},g={},l=[],G,C;u.nsd=f;u.setuser=function(a){v(a)&&(w("weibo_user",!0),f.user.weibo=!0,Y(a),g.fadeOut("#auth,#welcome",0.4))};var z=!1,Z=[];q.api_path="api/action.aspx";q.duration_second=1;e.animation={};e.screen={};e.animation.flash=function(a){var c=a.getIcon();c.fillOpacity=0.45;a.setIcon(c)};f.user={};f.user.weibo=!1;f.geoinfo={};e.gallery_id=0;e.mode={};e.mode.map=!0;e.mode.panorama=!1;e.mode.gallery=!1;
e.mode.detail=!1;e.mode.my_journey=!1;e.mode.quiz=!1;g.fadeIn=function(b,c,d,e){TweenLite.delayedCall(d,function(){a(b).show()});TweenLite.fromTo(b,c,{opacity:0},{opacity:1,delay:d===k?0:d,ease:Power2.easeOut,onComplete:e})};g.fadeOut=function(b,c,d,e){TweenLite.to(b,c,{opacity:0,delay:d===k?0:d,ease:Power2.easeOut,onComplete:function(){a(b).hide();e!==k&&e()}})};g.spin=function(b,c,d){Z.length>d&&clearTimeout(Z[d]);var e=0,f=Number(a(b).text().replace(",",""));if(a.isNumeric(f)){var g=c-f;if(0!=
g){var k=Math.floor(10*q.duration_second),l=Math.floor(g/k);1>Math.abs(l)&&(k=Math.abs(g),l=0>g?-1:1);var p=function(){e++;var l=g-g*Math.cos(Math.PI/2*(e/k)),l=f+Math.ceil(l);e>=k?a(b).text(A(c)):(a(b).text(A(l)),Z[d]=setTimeout(p,100))};p()}}};/Android|webOS|iPhone|iPod|IEMobile|BlackBerry/i.test(navigator.userAgent)?u.location.href="http://lr-nsd.com/mobile":a(function(){f.data={};var b=E("weibo_user");f.user.weibo=b||!1;Y({token:E("auth_token"),points:Number(E("user_points"))});a(u).resize(p);
if(u.google===k){b=E("first_visit");if(null!==b&&""!=b){u.location.href="home.html";return}w("first_visit","yes",90);if(0<a("#video_index").length&&a("html").hasClass("video"))a("#video_index").one("loadeddata",function(){g.fadeOut("#kv_index",0.1);var b=a("#video_index")[0];b.volume=0.5;b.play()})}else C=[{url:"img/ol-vehicle.png",anchor:new google.maps.Point(17.5,19.5)},"img/ol-dest-a.png","img/ol-dest-b.png","img/ol-dest-c.png",{url:"img/ol-stop.png",anchor:new google.maps.Point(11,10.5)},{url:"img/ol-spot.png",
anchor:new google.maps.Point(9,9)}],null==f.user.token&&(a("#welcome").addClass("visible"),g.fadeIn("#welcome",0.4,1),setTimeout(function(){g.fadeOut("#welcome",0.4)},1E4)),b=E("upgrade_ignore"),a("html").hasClass("lt-ie9")&&(null==b||""==b)&&setTimeout(qa,1E3),xa();Ca();p();b=E("bgm_mute");if(0<a("#bgm").length)if("yes"!=b){var c=a("#bgm")[0];c.play();setTimeout(function(){c.volume=0.25},200)}else a("#bgm_control i").removeClass("bgm-on").addClass("bgm-off"),a("#bgm_control span b").text("off")})})(jQuery,
window);
